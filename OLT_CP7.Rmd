---
title: "OLT Data Prep for Modeling"
author: "Ledia Dobi"
date: "`r Sys.Date()`"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Libraries


```{r libraries, include=TRUE}
required_packages <- c("dplyr", "readr", "tidyverse", "lmtest", "lubridate", "glmnet", "pls", "readxl", "GGally", "boot", "scales", "ggthemes", "caret")
install.packages(setdiff(required_packages, rownames(installed.packages())))
invisible(lapply(required_packages, library, character.only = TRUE))
```


## Changing Date on Unemployment Data


```{r Unemployment Data clean up, include=TRUE}
unemploy <- read.csv("Unemploy.csv")
class(unemploy$observation_date)
unemploy$observation_date <- ymd(unemploy$observation_date)
class(unemploy$observation_date)
unemploy$observation_date <- year(unemploy$observation_date)
view(unemploy)
```

## Changing Names of Columns


```{r renaming columns, include=TRUE}
colnames(unemploy) <- c("Year", "Unemploy_Rate")
head(unemploy)
```

## Group by Year, calculate mean of unemployment rate per year


```{r grouping by year, include=TRUE}
annual_unemploy <- unemploy %>%
  group_by(Year) %>%
  summarise(
    Annual_Avg_Rate = mean(Unemploy_Rate, na.rm = TRUE)
  )

head(annual_unemploy)
view(annual_unemploy)
```

## Aggregate years on Skincare and Makeup Data

```{r aaggregate years, include=TRUE}
skincare <- read.csv("All Dates Skincare.csv")
makeup <- read.csv ("Makeup Products.csv")
view(skincare)

#cleaning up due to $ character
skincare_agg <- skincare %>%
  mutate(
    Dollar.Sales.UD = gsub("[$,]", "", Dollar.Sales.UD), # Remove $ and ,
    Dollar.Sales.UD = as.numeric(Dollar.Sales.UD)        # Convert to number
  ) %>%
group_by(Category, Year) %>%
  summarise(
    Total.Dollar.Sales = sum(Dollar.Sales.UD, na.rm = TRUE), # Aggregates sales
    .groups = 'drop'
  )

view(skincare_agg)

makeup_agg <- makeup %>%
  group_by(Category, Year) %>%
  summarise(
    Total.Dollar.Sales = sum(Dollar.Sales.UD, na.rm = TRUE), # Calculate the sum of dollar sales
    .groups = 'drop' # Ungroup the data after summarizing
  )%>%

select(Year, Category, Total.Dollar.Sales)
view(makeup_agg)


```

## Change Axis on Skincare and Makeup Data

```{r axis change, include=TRUE}

makeup_wide <- makeup_agg %>%
  mutate(Year = as.numeric(as.character(Year))) %>%
  group_by(Year, Category) %>%
  # The summarise step is redundant here if makeup_agg is already aggregated, 
  # but we'll keep it to ensure data integrity.
  summarise(Total.Dollar.Sales = sum(Total.Dollar.Sales, na.rm = TRUE), .groups = "drop") %>%
  # Complete uses min() and max() to include all years found in the data
  complete(Year = min(Year, na.rm = TRUE):max(Year, na.rm = TRUE), 
           Category, 
           fill = list(Total.Dollar.Sales = 0)) %>%
  pivot_wider(
    names_from  = Category,
    values_from = Total.Dollar.Sales,
    values_fill = 0
  ) %>%
  arrange(Year)

view(makeup_wide)

skincare_wide <- skincare_agg %>%
  mutate(Year = as.numeric(as.character(Year))) %>%
  group_by(Year, Category) %>%
  # The summarise step is redundant here if skincare_agg is already aggregated, 
  # but we'll keep it to ensure data integrity.
  summarise(Total.Dollar.Sales = sum(Total.Dollar.Sales, na.rm = TRUE), .groups = "drop") %>%
  # Complete uses min() and max() to include all years found in the data
  complete(Year = min(Year, na.rm = TRUE):max(Year, na.rm = TRUE), 
           Category, 
           fill = list(Total.Dollar.Sales = 0)) %>%
  pivot_wider(
    names_from  = Category,
    values_from = Total.Dollar.Sales,
    values_fill = 0
  ) %>%
  arrange(Year)

view(skincare_wide)

```

## Combine Unemployment, Skincare, and Makeup Data


```{r combine datasets, include=TRUE}
combined_df <- skincare_wide %>%
  # 1. Join skincare_wide and makeup_wide. full_join keeps all years from both.
  full_join(makeup_wide, by = "Year") %>%
  # 2. Join the product data with the unemployment data.
  #    left_join keeps all years from the previous step. Years not found 
  #    in annual_unemploy (like pre-2010) will have NA for the rate.
  left_join(annual_unemploy, by = "Year") %>%
  # Optional: Reorder columns to place Year and Rate first
  select(
    Year,
    Annual_Avg_Rate, # Assuming this is the unemployment column name
    everything()
  )

view(combined_df)
```

## Create Dummy Variable for Recession Year


```{r dummy variable for recession, include=TRUE}
combined_df <- combined_df %>%
  # Use mutate and ifelse or case_when to create the dummy variable
  mutate(
    Recession_Year = case_when(
      Year == 2001 ~ 1,
      Year >= 2007 & Year <= 2009 ~ 1,
      Year == 2020 ~ 1,
      TRUE ~ 0 # Assign 0 to all other years
    )
  ) %>%
  # Reorder the columns to place Recession_Year next to Year
  select(
    Year,
    Recession_Year,
    everything()
  )

view(combined_df)
```
